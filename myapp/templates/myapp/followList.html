{% extends "myapp/base.html" %} 
{% load static %}
{% load custom_filter %}

{% block title %}
    {% if request.GET.list == 'following' %}Following{% elif request.GET.list == 'mutuals' %}Mutuals{% else %}Followers{% endif %} Â· {{ userinfo_obj.user.username }}
{% endblock %} 

{% block style %}
<link rel="stylesheet" href="{% static 'styles/user_profile_page.css' %}"/>
{% endblock %} 

{% block body_class %}text-[14px] h-full bg-[#0d1117] text-[#c9d1d9] overflow-x-hidden{% endblock %}

{% block content %}

<div class="flex flex-col lg:flex-row min-h-screen">
    
    <!-- Sidenav -->
    {% include "includes/sidenav.html" %}

    <!-- Main Content Area -->
    <main class="flex-1 flex flex-col items-center py-8 px-4 sm:px-6 lg:px-8 w-full">
        
        <!-- Modern Header -->
        <div class="w-full max-w-xl mb-8">
            <!-- Breadcrumb / Back -->
            <nav class="flex items-center gap-2 text-xs text-[#8b949e] mb-3">
                <a href="{% url 'index' %}" class="hover:text-[#58a6ff] transition-colors">Home</a>
                <span>/</span>
                <a href="{% url 'user_profile' userinfo_obj.user.username %}" class="hover:text-[#58a6ff] transition-colors">{{ userinfo_obj.user.username }}</a>
                <span>/</span>
                <span class="text-[#c9d1d9]">Network</span>
            </nav>

            <!-- Title Section -->
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-2xl sm:text-3xl font-bold text-white tracking-tight mb-1">
                        {% if request.GET.list == 'following' %}Following{% elif request.GET.list == 'mutuals' %}Mutuals{% else %}Followers{% endif %}
                    </p>
                    <p class="text-[#8b949e] text-sm">
                        People connected with <span class="text-[#c9d1d9] font-medium">@{{ userinfo_obj.user.username }}</span>
                    </p>
                </div>
                <a href="{% url 'user_profile' userinfo_obj.user.username %}" class="sm:flex items-center gap-2 px-3 py-1.5 rounded-lg border border-[#30363d] bg-[#21262d] text-xs font-medium text-[#c9d1d9] hover:bg-[#30363d] hover:text-white transition-all">
                    <i class="fa-solid fa-arrow-left"></i> Back to Profile
                </a>
            </div>
        </div>

        <!-- Main Card -->
        <div class="w-full max-w-xl bg-[#161b22] border border-[#30363d] rounded-xl overflow-hidden shadow-sm">
            
            <!-- Tabs -->
            <div class="flex border-b border-[#30363d]">
                <a href="?list=followers" class="flex-1 py-3 text-center text-sm font-medium transition-colors relative group
                    {% if request.GET.list == 'followers' or request.GET.list == None %}
                        text-white bg-[#21262d]/50
                    {% else %}
                        text-[#8b949e] hover:text-[#c9d1d9] hover:bg-[#21262d]/30
                    {% endif %}">
                    <span class="block text-xs text-[#8b949e] mb-0.5 group-hover:text-[#c9d1d9]">Followers</span>
                    <span class="text-base font-semibold">{{ followers_count }}</span>
                    {% if request.GET.list == 'followers' or request.GET.list == None %}
                        <div class="absolute bottom-0 left-0 right-0 h-0.5 bg-[#fd8c73]"></div>
                    {% endif %}
                </a>
                <a href="?list=following" class="flex-1 py-3 text-center text-sm font-medium transition-colors relative group
                    {% if request.GET.list == 'following' %}
                        text-white bg-[#21262d]/50
                    {% else %}
                        text-[#8b949e] hover:text-[#c9d1d9] hover:bg-[#21262d]/30
                    {% endif %}">
                    <span class="block text-xs text-[#8b949e] mb-0.5 group-hover:text-[#c9d1d9]">Following</span>
                    <span class="text-base font-semibold">{{ following_count }}</span>
                    {% if request.GET.list == 'following' %}
                        <div class="absolute bottom-0 left-0 right-0 h-0.5 bg-[#fd8c73]"></div>
                    {% endif %}
                </a>
                <a href="?list=mutuals" class="flex-1 py-3 text-center text-sm font-medium transition-colors relative group
                    {% if request.GET.list == 'mutuals' %}
                        text-white bg-[#21262d]/50
                    {% else %}
                        text-[#8b949e] hover:text-[#c9d1d9] hover:bg-[#21262d]/30
                    {% endif %}">
                    <span class="block text-xs text-[#8b949e] mb-0.5 group-hover:text-[#c9d1d9]">Mutuals</span>
                    <span class="text-base font-semibold">{{ mutuals_count }}</span>
                    {% if request.GET.list == 'mutuals' %}
                        <div class="absolute bottom-0 left-0 right-0 h-0.5 bg-[#fd8c73]"></div>
                    {% endif %}
                </a>
            </div>

            <!-- List Content -->
            <div class="divide-y divide-[#30363d] max-h-[65vh] overflow-y-auto custom-scrollbar">
                {% if user_list %}
                    {% for people in user_list %}
                    <div class="flex items-center justify-between px-4 py-4 hover:bg-[#21262d]/50 transition-colors group">
                        
                        <!-- User Info -->
                        <div class="flex items-center gap-3 flex-1 min-w-0">
                            <a href="{% url 'user_profile' people.user.username %}" class="relative shrink-0">
                                <img src="{{people.profile_image.url}}?v={{people.updated_at.timestamp}}" 
                                     class="w-11 h-11 rounded-full border border-[#30363d] object-cover group-hover:border-[#8b949e] transition-colors" 
                                     alt="{{people.user.username}}">
                            </a>
                            
                            <div class="flex flex-col min-w-0">
                                <a href="{% url 'user_profile' people.user.username %}" class="text-sm font-semibold text-white hover:underline truncate">
                                    {{people.user.username}}
                                </a>
                                <div class="flex items-center gap-1 text-xs text-[#8b949e]">
                                    <span class="truncate">{{people.user.first_name}} {{people.user.last_name}}</span>
                                    {% if people.coding_style %}
                                        <span class="w-0.5 h-0.5 bg-[#8b949e] rounded-full"></span>
                                        <img src="{% static 'assets/coding-style-logo/' %}{{people.coding_style.logo}}" 
                                             class="w-3 h-3 opacity-70" 
                                             alt="{{people.coding_style.name}}"
                                             title="{{people.coding_style.name}}">
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Action Button -->
                        <div class="ml-4 shrink-0">
                            {% if user.info == people %}
                                <!-- Self -->
                            {% else %}
                                {% if user.info|is_following:people %}
                                    <button class="follow-btn px-4 py-1.5 bg-[#21262d] hover:bg-[#30363d] text-[#c9d1d9] border border-[#30363d] rounded-lg text-xs font-medium transition-all w-[90px] group-hover:border-[#8b949e]" 
                                            data-user-id="{{ people.id }}">
                                        Following
                                    </button>
                                {% else %}
                                    <button class="follow-btn px-4 py-1.5 bg-[#238636] hover:bg-[#2ea043] text-white border border-[rgba(240,246,252,0.1)] rounded-lg text-xs font-medium transition-all w-[90px] shadow-sm" 
                                            data-user-id="{{ people.id }}">
                                        Follow
                                    </button>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <!-- Empty State -->
                    <div class="flex flex-col items-center justify-center py-16 px-4 text-center">
                        <div class="w-16 h-16 bg-[#21262d] rounded-full flex items-center justify-center mb-4 border border-[#30363d]">
                            <i class="fa-solid fa-user-group text-[#8b949e] text-2xl"></i>
                        </div>
                        <h3 class="text-white font-medium mb-1">No connections yet</h3>
                        <p class="text-[#8b949e] text-sm max-w-xs mx-auto">
                            {% if request.GET.list == 'following' %}
                                {{ userinfo_obj.user.username }} isn't following anyone.
                            {% elif request.GET.list == 'mutuals' %}
                                No mutual connections found.
                            {% else %}
                                {{ userinfo_obj.user.username }} doesn't have any followers.
                            {% endif %}
                        </p>
                    </div>
                {% endif %}
            </div>

            <!-- Pagination -->
            {% if user_list.paginator.num_pages > 1 %}
            <div class="border-t border-[#30363d] bg-[#0d1117]/50 p-3 flex justify-center">
                <div class="flex items-center gap-1">
                    {% if user_list.has_previous %}
                        <a href="?list={{request.GET.list}}&page={{user_list.previous_page_number}}" class="p-1.5 text-[#8b949e] hover:text-[#58a6ff] transition-colors rounded-md hover:bg-[#21262d]">
                            <i class="fa-solid fa-chevron-left"></i>
                        </a>
                    {% endif %}
                    
                    <span class="text-xs text-[#8b949e] font-medium px-3 py-1 bg-[#21262d] rounded-md border border-[#30363d]">
                        {{ user_list.number }} / {{ user_list.paginator.num_pages }}
                    </span>

                    {% if user_list.has_next %}
                        <a href="?list={{request.GET.list}}&page={{user_list.next_page_number}}" class="p-1.5 text-[#8b949e] hover:text-[#58a6ff] transition-colors rounded-md hover:bg-[#21262d]">
                            <i class="fa-solid fa-chevron-right"></i>
                        </a>
                    {% endif %}
                </div>
            </div>
            {% endif %}

        </div>
    </main>
</div>

<style>
    .custom-scrollbar::-webkit-scrollbar {
        width: 6px;
    }
    .custom-scrollbar::-webkit-scrollbar-track {
        background: transparent;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb {
        background-color: #30363d;
        border-radius: 20px;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background-color: #8b949e;
    }
</style>

{% endblock %}